# โค้ดที่ป้องกันการล็อกเงินไว้ใน Contract
เพื่อป้องกันกรณีที่เงินถูกล็อกไว้ใน Contract โดยที่ไม่มีทางนำออกได้ โค้ดมีการใช้กลไกดังนี้:
SingleplayTimeOut()
ใช้ในกรณีที่มีผู้เล่นคนเดียวแต่ไม่มีคู่แข่งเข้ามาร่วมเล่นภายใน TIMEOUT (3 นาที)
หากเลยเวลาแล้ว ผู้เล่นคนเดิมสามารถเรียกฟังก์ชันนี้เพื่อรับเงินคืน
MultiPlayTimeOut()
ใช้ในกรณีที่มีผู้เล่น 2 คน แต่ไม่มีคนใดคนหนึ่งทำการ revealChoice() ภายใน TIMEOUT
หากมีผู้เล่นที่ไม่เปิดเผยค่าเลือกของตนภายในเวลาที่กำหนด ผู้เล่นที่เปิดเผยค่าของตัวเองจะได้รับเงินรางวัลแทน
ป้องกันกรณีที่ผู้เล่นพยายามล็อกเกมโดยไม่ยอมเปิดเผยค่าเลือกของตนเอง

# โค้ดส่วนที่ทำการซ่อน choice และ commit
โค้ดใช้กลไก Commit-Reveal Scheme เพื่อซ่อนตัวเลือกของผู้เล่นก่อนที่จะเปิดเผยทีหลัง:
getChoiceHash(uint choice, string memory secret)
สร้างค่า hash ที่ผูกกับตัวเลือก (choice) และรหัสลับ (secret) ของผู้เล่น
keccak256(abi.encodePacked(keccak256(abi.encodePacked(choice, secret))))
ใช้ hash ซ้อนกัน 2 ชั้นเพื่อให้ยากต่อการเดา
commitChoice(bytes32 commitHash)
ผู้เล่นส่งค่า hash ที่ได้จาก getChoiceHash() เพื่อเป็นหลักฐานว่าเลือกอะไรไปแล้ว โดยยังไม่เปิดเผยค่าจริง
บันทึกค่า hash ลงใน commitments[msg.sender]
กำหนดค่า hasCommitted[msg.sender] = true; เพื่อบันทึกว่าผู้เล่นได้ทำการ commit แล้ว
สิ่งนี้ช่วยป้องกันไม่ให้ผู้เล่นคนหนึ่งเห็นตัวเลือกของอีกฝ่ายก่อนแล้วเลือกตัวเลือกที่ชนะได้ง่าย ๆ

#  โค้ดที่จัดการกับความล่าช้าเมื่อผู้เล่นไม่ครบทั้งสองคน
หากมีปัญหาที่ผู้เล่นไม่ทำตามขั้นตอนภายในเวลาที่กำหนด มี 2 กรณีที่ต้องจัดการ:
กรณีที่มีผู้เล่นเพียงคนเดียว
ฟังก์ชัน SingleplayTimeOut()
หากมีแค่ 1 คนที่ addPlayer() แล้วรอเกิน TIMEOUT (3 นาที) โดยไม่มีใครมาเล่นด้วย
ผู้เล่นคนเดิมสามารถเรียกฟังก์ชันนี้เพื่อรับเงินคืนโดย payable(players[0]).transfer(reward);
จากนั้น DeleteGame(); เพื่อล้างค่าทุกอย่างให้เริ่มเกมใหม่
กรณีที่มีผู้เล่น 2 คน แต่ไม่มีคนทำการเปิดเผยค่าเลือก
ฟังก์ชัน MultiPlayTimeOut()
หากมีผู้เล่น 2 คนแล้ว แต่คนใดคนหนึ่งไม่ทำ revealChoice() ภายในเวลาที่กำหนด
ฟังก์ชันนี้จะให้สิทธิ์คนที่เปิดเผยค่าไปแล้วได้รับเงินรางวัล (reward / 2)
หากไม่มีใครเปิดเผยเลย เงินรางวัลจะไม่ได้ถูกแจกออกไป
จากนั้น DeleteGame(); เพื่อล้างค่าทุกอย่าง

# โค้ดที่ทำการ reveal และตัดสินผู้ชนะ
revealChoice(uint choice, string memory secret)
ตรวจสอบว่าเป็นผู้เล่นจริงและเคย commitChoice() แล้ว
ตรวจสอบว่า choice กับ secret ตรงกับที่ commit ไว้
บันทึกค่าเลือกจริง (player_choice[msg.sender]) และกำหนดว่าได้เปิดเผยแล้ว (hasRevealed[msg.sender])
หากผู้เล่นทั้งสองเปิดเผยครบ (numInput == 2) → เรียก _checkWinnerAndPay();
_checkWinnerAndPay()
ใช้ (choice + 1) % 5 เพื่อตัดสินว่าใครชนะ
หากเสมอ → แบ่งเงินรางวัล
ผู้ชนะได้รับทั้งหมด
ล้างข้อมูลเกม (DeleteGame();)
